# 4. Codebase Structure

This document provides an overview of the directory structure and key files within the `blvke-chat-app` project.

## Root Directory

The root directory contains configuration files, setup scripts, and top-level project definitions.

*   `.env`: Local environment variables (ignored by Git). Created from `.env.example`.
*   `.env.example`: Template for environment variables.
*   `.gitignore`: Specifies intentionally untracked files that Git should ignore.
*   `components.json`: Configuration for `shadcn/ui` components.
*   `eslint.config.js`: Configuration for ESLint, used for code linting.
*   `middleware.ts`: (Potentially duplicated in `src/`) Next.js middleware for handling requests before they reach a page or API route (e.g., for authentication checks).
*   `next.config.js`: Configuration file for the Next.js framework.
*   `package.json`: Lists project dependencies, scripts, and metadata.
*   `package-lock.json`: Records exact versions of dependencies.
*   `postcss.config.js`: Configuration for PostCSS (used by Tailwind CSS).
*   `prettier.config.js`: Configuration for Prettier, used for code formatting.
*   `README.md`: Project overview and basic instructions.
*   `start-database.sh`: Script to initialize the local development database using Docker/Podman.
*   `tailwind.config.ts`: Configuration for Tailwind CSS.
*   `tsconfig.json`: Configuration for the TypeScript compiler.

## Key Directories

*   **`app/`**: (Likely contains older or non-page related global styles/assets if both `app` and `src/app` exist). Contains `globals.css`. *Note: The primary application code using the App Router resides in `src/app/`.*
*   **`blake_docs/`**: Contains this technical documentation.
*   **`prisma/`**:
    *   `schema.prisma`: Defines the database schema, models, and relations managed by Prisma.
    *   `migrations/`: Contains SQL migration files generated by `prisma migrate dev`.
*   **`public/`**: Static assets that are served directly, such as images (`favicon.ico`), fonts, etc.
*   **`src/`**: The main source code directory.
    *   **`app/`**: Core directory for the Next.js App Router implementation.
        *   `layout.tsx`: Defines the root layout shared across all pages.
        *   `page.tsx`: The main entry point/homepage of the application.
        *   `_components/`: Internal components specific to certain routes/pages within the `app` directory.
        *   `api/`: Contains API route handlers (both standard Next.js API routes and the tRPC handler).
            *   `auth/`: Authentication-related API endpoints (using NextAuth.js).
            *   `chat/`: API route likely handling AI chat interactions.
            *   `conversations/`: API routes for managing chat conversations (potentially RESTful if not using tRPC for everything).
            *   `trpc/[trpc]/`: The dynamic route handler that catches all tRPC requests.
        *   `(route-groups)/`: Parenthesized directories like `(auth)`, `(main)` might be used for organizing routes without affecting the URL path (e.g., applying different layouts).
        *   `chat/`, `landing/`, `login/`, `register/`, `settings/`: Subdirectories defining different pages/routes of the application. Each typically contains a `page.tsx` file.
    *   **`components/`**: Reusable React components shared across the application.
        *   `ui/`: UI primitive components provided by `shadcn/ui` (Button, Card, Input, etc.).
        *   Other `.tsx` files: Application-specific components (e.g., `chat-interface.tsx`, `login-form.tsx`).
    *   **`hooks/`**: Custom React hooks (e.g., `use-toast.ts`).
    *   **`lib/`**: Utility functions, library initializations, and helper modules.
        *   `auth.ts`: Authentication-related utility functions or configurations.
        *   `db.ts`, `db-adapter.ts`, `mock-db.ts`: Database connection/adapter logic (likely related to Prisma and potentially a mock DB mode).
        *   `utils.ts`: General utility functions.
        *   Other files: Specific logic modules (e.g., `conversations.ts`, `settings.ts`).
    *   **`pages/`**: (Potentially contains older code using the Pages Router or specific API routes not migrated to `src/app/api`). *Note: The primary structure seems to be the App Router (`src/app/`).*
        *   `api/`: Older API routes.
    *   **`server/`**: Backend-specific code, primarily for tRPC and authentication.
        *   `api/`: tRPC router definitions.
            *   `root.ts`: Merges all tRPC routers.
            *   `trpc.ts`: tRPC server setup and context creation.
            *   `routers/`: Individual tRPC routers for different concerns (e.g., `conversation.ts`, `post.ts`, `settings.ts`).
        *   `auth.ts`: Server-side NextAuth.js configuration.
        *   `db.ts`: Prisma client instance initialization for the server.
    *   **`styles/`**: Global styles (though `app/globals.css` might be the primary one used with the App Router).
    *   **`trpc/`**: tRPC client-side setup and integration (React Query provider).
    *   **`utils/`**: (Potentially duplicated or older utilities, compare with `src/lib/utils.ts`). Contains `api.ts` which might be the tRPC client helper.
    *   `env.js`, `env.mjs`: Environment variable validation using `@t3-oss/env-nextjs`.
    *   `middleware.ts`: (If present here) Next.js middleware.

## Coding Conventions

*   **Language:** TypeScript.
*   **Linting:** Enforced by ESLint (`eslint.config.js`).
*   **Formatting:** Enforced by Prettier (`prettier.config.js`), likely integrated with the Tailwind CSS plugin (`prettier-plugin-tailwindcss`).
*   **Framework:** Follows Next.js (App Router) conventions.
*   **API:** Primarily uses tRPC for type-safe APIs, with some standard Next.js API routes.
*   **UI:** Uses `shadcn/ui` components and Tailwind CSS.